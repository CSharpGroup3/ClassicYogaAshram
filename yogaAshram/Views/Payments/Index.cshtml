@model PaymentsIndexModelView
@{ 
    ViewBag.Title = "Список платежей";
    string jsonModel = System.Text.Json.JsonSerializer.Serialize(Model); 
}
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" />
    <div class="card text-center">
        <div class="card-header">
            <form class="mb-3 border-bottom" asp-action="Index" style="margin-left:300px;">
                <div class="form-row align-items-center">
                    <div class="col-auto">
                        <input placeholder="Поиск клиента по имени" type="text" class="form-control mb-2" asp-for="FilterByName">
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-primary mb-2">Фильтровать</button>
                    </div>
                </div>
            </form>
            <form asp-action="Index" class="mt-3" style="margin-left:300px">
                <div class="form-row align-items-center">
                    <div class="col-auto">
                        <div class="form-group">
                            <select asp-for="SortSelect" class="form-control">
                                <option value="">Сортирока по</option>
                                <option value="@SortPaymentsBy.Memberships">По абонементу</option>
                                <option value="@SortPaymentsBy.Price">По цене</option>
                                <option value="@SortPaymentsBy.Group">По группе</option>
                                <option value="@SortPaymentsBy.Comment">По комментарию</option>
                                <option value="@SortPaymentsBy.Sickness">По болезние</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check mb-2">
                            <input asp-for="SortReverse" class="form-check-input" type="checkbox" id="autoSizingCheck">
                            <label class="form-check-label" for="autoSizingCheck">
                                В обратном порядке
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-primary mb-2">Сортировать</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="card-body">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Абонемент</th>
                        <th scope="col">Оплаченная сумма</th>
                        <th scope="col">Имя клиента, номер телефона</th>
                        <th scope="col">Дата создания</th>
                        <th scope="col">Тип оплаты</th>
                        <th scope="col">Комментарий</th>
                        @if (User.IsInRole("chief"))
                        {
                            <th scope="col"></th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var payment in Model.Payments)
                    {
                    <tr>
                        <th scope="row">@payment.Id</th>
                        <td scope="row">@payment.Membership.Category.Name @payment.Membership.Price тг. @payment.Membership.AttendanceDays посещений</td>
                        <td scope="row">@(payment.Membership.Price - payment.Debts)</td>
                        <td scope="row">@payment.Client.NameSurname, @payment.Client.PhoneNumber</td>
                        <td scope="row">@payment.CateringDate.ToShortDateString()</td>
                        <td scope="row">@payment.Comment</td>
                        <td scope="row">
                            @if (payment.Type == PaymentType.Cash)
                            {
                                <span>Налл</span>
                            }
                            else
                            {
                                <span>Безналл</span>
                            }
                        </td>
                        @if (User.IsInRole("chief"))
                        {
                            <td scope="row"><i id="@payment.Id" class="far fa-edit editIcon"></i></td>
                        }
                    </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="card-footer text-muted d-flex justify-content-between">
            @if (Model.CurrentPage != 1)
            {
                <a role="button" class="btn btn-outline-dark" asp-action="Index" asp-route-model="@jsonModel" asp-route-pageTo="@(Model.CurrentPage - 1)">
                    Назад
                </a>
            }
            @if (Model.IsNextPage)
            {
                <a role="button" class="btn btn-outline-dark" asp-action="Index" asp-route-model="@jsonModel" asp-route-pageTo="@(Model.CurrentPage + 1)">
                    Вперёд
                </a>
            }
        </div>
    </div>
@section Scripts{ 
    @if (User.IsInRole("chief"))
    {
    <div id="editModals"></div>
    <script>
        var payments = $('.editIcon');
        for (var i = 0; i < payments.length; i++) {
            let payment = payments[i];
            $(payment).on('click', function () {
                $.get('@Url.Action("GetEditModalAjax", "Payments")/?paymentId=' + $(payment).attr('id'), function (data) {
                    $('#editModals').html(data);
                    $(document.getElementById("paymentEditModal")).modal('show');
                })
            })
        }
    </script>
    }
}